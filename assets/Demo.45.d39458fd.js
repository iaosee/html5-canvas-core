import{G as h}from"./lil-gui.esm.7a5dd4ff.js";import{B as c}from"./BaseDemo.deaf79c0.js";const d="/html5-canvas-core/assets/video-01.2839360d.mp4";class o extends c{constructor(t){super(t),this.canvas=t,this.name="\u89C6\u9891 \u2014\u2014 \u89C6\u9891\u6E32\u67D3\u7ED8\u5236",this.video=null,this.config={color:!0,flip:!1,play:()=>this.playVideo(),pause:()=>this.pauseVideo()},this.createVedio().createControl().initOffScreenCanvas().listenEvents()}static init(t){return new o(t)}start(){return this}draw(){return this}destroy(){super.destroy(),this.pauseVideo()}initOffScreenCanvas(){const{canvas:t}=this;return this.offScreenCanvas=document.createElement("canvas"),this.offScreenContext=this.offScreenCanvas.getContext("2d"),this.offScreenCanvas.width=t.width,this.offScreenCanvas.height=t.height,this}createControl(){const{config:t}=this;this.gui=new h;const{gui:e}=this;return e.add(t,"color"),e.add(t,"flip"),e.add(t,"play"),e.add(t,"pause"),this}createVedio(){return this.video=document.createElement("video"),this.video.src=d,this}playVideo(){const{canvas:t,context:e,config:a}=this;if(!this.video.paused)return this;const s=()=>{this.offScreenContext.drawImage(this.video,0,0),a.color||this.removeColor(),a.flip?this.drawFlipped():e.drawImage(this.offScreenCanvas,0,0),requestAnimationFrame(s)};return this.video.play(),requestAnimationFrame(s),this}pauseVideo(){return this.video.pause(),this}removeColor(){const{offScreenCanvas:t,offScreenContext:e}=this,a=e.getImageData(0,0,t.width,t.height),s=a.data,r=s.length;for(let i=0;i<r-4;i+=4){const n=(s[i]+s[i+1]+s[i+2])/3;s[i]=n,s[i+1]=n,s[i+2]=n}e.putImageData(a,0,0)}drawFlipped(){const{canvas:t,context:e,offScreenCanvas:a}=this;e.save(),e.translate(this.width/2,this.height/2),e.rotate(Math.PI),e.translate(-this.width/2,-this.height/2),e.drawImage(a,0,0),e.restore()}listenEvents(){const{canvas:t}=this;return t.addEventListener("click",e=>{console.log(e)}),this}}export{o as Demo};
