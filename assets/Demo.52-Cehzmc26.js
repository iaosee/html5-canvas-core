var f=Object.defineProperty;var S=(o,s,t)=>s in o?f(o,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[s]=t;var i=(o,s,t)=>S(o,typeof s!="symbol"?s+"":s,t);import{G as P}from"./lil-gui.esm-hsJpI9MV.js";import{B as v}from"./BaseDemo-DB1y7toB.js";import{A as T}from"./AnimationTimer-DJQ6xzIw.js";import{S as m}from"./Sprite-9nB6cOPC.js";import{I as l}from"./ImagePainter-B-NpNDxt.js";import{S as b,r as u,R as c,M as w,J as N,a as A}from"./RunnerSprite-Yg9z0LSO.js";import{b as y}from"./bomb-BLXqLVh_.js";class x{constructor(s=[],t){i(this,"painters",[]);i(this,"duration",1e3);i(this,"startTime",0);i(this,"index",0);i(this,"elapsedCallback",()=>{});this.painters=s,this.elapsedCallback=t||this.elapsedCallback}end(s,t){s.animating=!1,this.elapsedCallback?this.elapsedCallback(s):s.painter=t}start(s,t){const e=+new Date+t,n=t/this.painters.length,r=s.painter;let a=null;this.index=0,s.animating=!0,s.painter=this.painters[this.index],a=setInterval(()=>{+new Date<e?s.painter=this.painters[++this.index]:(this.end(s,r),clearInterval(a))},n)}}const I="/html5-canvas-core/assets/bomb-no-fuse-Cu4p7Q0s.png";class g extends v{constructor(t){super(t);i(this,"name","精灵绘制器 —— 精灵表绘制器/帧动画");i(this,"sprite");i(this,"sprite2");i(this,"sprite3");i(this,"sprite4");i(this,"pushTimer",new T);i(this,"lastAdvance",0);i(this,"bomb");i(this,"bombPainter");i(this,"bombNoFusePainter");i(this,"fuseBurningPainters",[]);i(this,"explosionPainters",[]);i(this,"fuseBurningAnimator");i(this,"explosionAnimator");i(this,"config",{RUN_INTERVAL:100,move4:()=>{this.pushTimer.start()},stop4:()=>{this.pushTimer.stop()},explode:()=>this.bombExplode()});this.canvas=t,this.createControl().initSprite().initBombSprite()}static init(t){return new g(t)}createControl(){const{config:t}=this;this.gui=new P;const{gui:e}=this;return e.add(t,"RUN_INTERVAL").min(10).max(1e3).step(1),e.add(t,"move4"),e.add(t,"stop4"),e.add(t,"explode"),this}draw(t){return this.clearScreen().drawGrid().drawScene(t)}initSprite(){const t=[{x:0,y:0,width:47,height:64},{x:55,y:0,width:44,height:64},{x:107,y:0,width:39,height:64},{x:150,y:0,width:46,height:64},{x:208,y:0,width:49,height:64},{x:265,y:0,width:46,height:64},{x:320,y:0,width:42,height:64},{x:380,y:0,width:35,height:64},{x:425,y:0,width:35,height:64}];return this.sprite=new m("Sprite 1",new b(u,t)),this.sprite2=new m("Sprite 2",new b(u,t),[new c,new w]),this.sprite3=new m("Sprite 3",new b(u,t),[new c,new w,new N]),this.sprite4=new m("Sprite 4",new b(u,t),[new c,new A(this.pushTimer)]),this.sprite.setX(200),this.sprite.setY(200),this.sprite2.setX(400),this.sprite2.setY(200),this.sprite3.setX(600),this.sprite3.setY(200),this.sprite4.setX(800),this.sprite4.setY(200),this.sprite2.velocityX=60,this.sprite3.velocityX=60,this.sprite4.velocityX=60,this}initBombSprite(){this.bombPainter=new l(y),this.bombNoFusePainter=new l(I),this.bomb=new m("bomb",this.bombPainter),this.bomb.setX(500),this.bomb.setY(500);for(let n=0;n<9;++n)this.fuseBurningPainters.push(new l("html5-canvas-core/images/bomb/fuse-0"+n+".png"));for(let n=0;n<9;++n)this.explosionPainters.push(new l("html5-canvas-core/images/bomb/explosion-0"+n+".png"));this.fuseBurningAnimator=new x(this.fuseBurningPainters,()=>{this.bomb.painter=this.bombNoFusePainter}),this.explosionAnimator=new x(this.explosionPainters,()=>{this.bomb.painter=this.bombNoFusePainter})}bombExplode(){const{bomb:t,bombPainter:e,fuseBurningAnimator:n,explosionAnimator:r}=this;t.animating||(n.start(t,2e3),setTimeout(()=>{r.start(t,1e3),setTimeout(()=>{t.painter=e},2e3)},3e3))}drawScene(t){const{context:e,config:n,sprite:r,sprite2:a,sprite3:h,sprite4:p,bomb:d}=this;return t-this.lastAdvance>n.RUN_INTERVAL&&(r.painter.advance(),this.lastAdvance=t),r.paint(e),e.fillText(r.name,r.x,r.y),a.update(e,t),a.paint(e),e.fillText(a.name,a.x,a.y),h.update(e,t),h.paint(e),e.fillText(h.name,h.x,h.y),p.update(e,t),p.paint(e),e.fillText(p.name,p.x,p.y),d.update(e,t),d.paint(e),this}}export{g as Demo};
