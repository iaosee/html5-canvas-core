var m=Object.defineProperty;var u=(d,r,t)=>r in d?m(d,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[r]=t;var o=(d,r,t)=>(u(d,typeof r!="symbol"?r+"":r,t),t);import{G as w}from"./lil-gui.esm.7a5dd4ff.js";import{B as I}from"./BaseDemo.9c35b300.js";import{i as S}from"./flower.21c0439b.js";class g extends I{constructor(t){super(t);o(this,"name","\u56FE\u50CF\u6E32\u67D3\u6DE1\u5165\u6DE1\u51FA");o(this,"image");o(this,"originalImageData");o(this,"offScreenCanvas");o(this,"offScreenContext");o(this,"config",{scale:.2,LENS_RADIUS:this.canvas.width/5,resetScene:()=>this.drawScene(),fadeIn:()=>this.fadeIn(),fadeOut:()=>this.fadeOut()});this.canvas=t,this.initOffScreenCanvas(),this.loadImage(S).then(e=>this.image=e).then(()=>{this.drawScene()}),this.createControl()}static init(t){return new g(t)}start(){return this}draw(){return this}initOffScreenCanvas(){const{canvas:t}=this;this.offScreenCanvas=document.createElement("canvas"),this.offScreenContext=this.offScreenCanvas.getContext("2d"),this.offScreenCanvas.width=t.width,this.offScreenCanvas.height=t.height}createControl(){const{config:t}=this;this.gui=new w;const{gui:e}=this;return e.add(t,"scale").step(.01).min(.1).max(1).onChange(()=>this.drawScene()),e.add(t,"fadeIn"),e.add(t,"fadeOut"),this}drawScene(){const{context:t,offScreenContext:e,canvas:n,config:i,image:s}=this,h=n.width,a=n.height,f=s.width*i.scale/s.width,l=s.width*i.scale,c=s.height*f;return t.clearRect(0,0,n.width,n.height),e.clearRect(0,0,n.width,n.height),e.drawImage(this.image,-l/2+h/2,-c/2+a/2,l,c),this.originalImageData=e.getImageData(0,0,n.width,n.height),this}fadeIn(){const{offScreenContext:t,canvas:e}=this,n=t.getImageData(0,0,e.width,e.height);this.doFadeAnimate(n,0,0,20,0)}fadeOut(){const{context:t,canvas:e}=this;t.putImageData(this.originalImageData,0,0);const n=t.getImageData(0,0,e.width,e.height);this.doFadeAnimate(n,0,0,20,1)}doFadeAnimate(t,e,n,i,s=0){const{context:h}=this;let a=0,f;if(s===0)for(let c=3;c<t.data.length;c+=4)t.data[c]=0;const l=c=>{a++,f=requestAnimationFrame(l),a>i&&cancelAnimationFrame(f),s===0?this.increaseTransparency(t,i):this.decreaseTransparency(t,i),h.putImageData(t,e,n)};return f=requestAnimationFrame(l),this}decreaseTransparency(t,e){const n=t.data.length;let i,s,h;for(let a=3;a<n;a+=4)i=this.originalImageData.data[a],i>0&&t.data[a]>0&&(s=t.data[a],h=Math.ceil(i/e),s-h>0?t.data[a]-=h:t.data[a]=0)}increaseTransparency(t,e){const n=t.data.length;let i,s,h;for(let a=3;a<n;a+=4)i=this.originalImageData.data[a],i>0&&(s=t.data[a],h=Math.ceil(i/e),s+h<=i?t.data[a]+=h:t.data[a]=i)}}export{g as Demo};
