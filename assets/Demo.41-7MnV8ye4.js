var d=Object.defineProperty;var m=(c,n,t)=>n in c?d(c,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[n]=t;var h=(c,n,t)=>m(c,typeof n!="symbol"?n+"":n,t);import{G as w}from"./lil-gui.esm-hsJpI9MV.js";import{B as S}from"./BaseDemo-DB1y7toB.js";import{S as u,E as v,B as x,N as I}from"./SunglassesFilter-D7wnYvpw.js";import{i as C}from"./flower-BOKp_aAz.js";class l extends S{constructor(t){super(t);h(this,"name","图像处理 —— 裁剪应用部分滤镜");h(this,"image");h(this,"offScreenCanvas");h(this,"offScreenContext");h(this,"originalImageData");h(this,"config",{scale:.2,filter:0,LENS_RADIUS:this.width/5,resetScene:()=>this.drawScene(),putFilterOn:()=>this.putFilterOn()});this.canvas=t,this.initOffScreenCanvas(),this.loadImage(C).then(e=>this.image=e).then(()=>{this.drawScene()}),this.createControl()}static init(t){return new l(t)}start(){return this}draw(){return this}initOffScreenCanvas(){const{canvas:t}=this;this.offScreenCanvas=document.createElement("canvas"),this.offScreenContext=this.offScreenCanvas.getContext("2d"),this.offScreenCanvas.width=t.width,this.offScreenCanvas.height=t.height,this.offScreenContext.scale(this.dpr,this.dpr)}createControl(){const{config:t}=this;this.gui=new w;const{gui:e}=this;return e.add(t,"scale").step(.01).min(.1).max(1).onChange(()=>this.drawScene()),e.add(t,"filter",{default:0,negative:1,black_white:2,embossment:3,sunglasses:4}).onFinishChange(a=>this.config.filter=Number(a)),e.add(t,"resetScene"),e.add(t,"putFilterOn"),this}drawScene(){const{canvas:t,context:e,config:a,image:s}=this,o=this.width,i=this.height,r=s.width*a.scale/s.width,f=s.width*a.scale,g=s.height*r;return e.clearRect(0,0,t.width,t.height),e.drawImage(this.image,-f/2+o/2,-g/2+i/2,f,g),this.originalImageData=e.getImageData(0,0,t.width,t.height),this}putFilterOn(){const{canvas:t,context:e,config:a}=this,s={x:this.center.x-a.LENS_RADIUS-10,y:this.center.y},o={x:this.center.x+a.LENS_RADIUS+10,y:this.center.y};let i=null;e.putImageData(this.originalImageData,0,0);const r=e.getImageData(0,0,t.width,t.height);switch(a.filter){case 1:i=new I(r);break;case 2:i=new x(r);break;case 3:i=new v(r);break;case 4:i=new u(r);break;default:i=null}i&&i.dye(),this.offScreenContext.putImageData(r,0,0),this.drawLenses(s,o)}drawLenses(t,e){const{context:a,config:s,offScreenCanvas:o}=this;return a.save(),a.beginPath(),a.arc(t.x,t.y,s.LENS_RADIUS,0,Math.PI*2,!1),a.moveTo(e.x,e.y),a.arc(e.x,e.y,s.LENS_RADIUS,0,Math.PI*2,!1),a.clip(),a.drawImage(o,0,0,this.canvas.width,this.canvas.height),a.restore(),this}}export{l as Demo};
