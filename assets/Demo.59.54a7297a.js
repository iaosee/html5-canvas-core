import{P as s,B as u}from"./BaseDemo.deaf79c0.js";import{P as p}from"./Polygon.fb0fffd3.js";import{S as w}from"./Sprite.ec3d1e74.js";import{I as c}from"./ImagePainter.41ffde97.js";import{g as y}from"./golfball.de451e99.js";class x extends p{constructor(t){super(t),this.imageLoaded=!1,this.image=new Image,this.points=[new s(t.x,t.y)],this.image.src=t.imageSource,this.image.addEventListener("load",h=>{this.setPolygonPoints(),this.imageLoaded=!0},!1)}setPolygonPoints(){this.points.push(new s(this.x+this.image.width,this.y)),this.points.push(new s(this.x+this.image.width,this.y+this.image.height)),this.points.push(new s(this.x,this.y+this.image.height))}drawImage(t){t.drawImage(this.image,this.points[0].x,this.points[0].y)}fill(t){return this}stroke(t){return this.imageLoaded?t.drawImage(this.image,this.points[0].x,this.points[0].y):this.image.addEventListener("load",h=>this.drawImage(t),!1),this}}class f extends p{constructor(t){super(t),this.sprite=t.sprite,this.sprite.left=this.x,this.sprite.top=this.y,this.setPolygonPoints()}setPolygonPoints(){this.points.push(new s(this.x,this.y)),this.points.push(new s(this.x+this.sprite.width,this.y)),this.points.push(new s(this.x+this.sprite.width,this.y+this.sprite.height)),this.points.push(new s(this.x,this.y+this.sprite.height))}move(t,h){for(var e=0;e<this.points.length;++e){const n=this.points[e];n.x+=t,n.y+=h}return this.sprite.left=this.points[0].x,this.sprite.top=this.points[0].y,this}fill(t){return this}stroke(t){return this.sprite.paint(t),this}}const P="/html5-canvas-core/assets/tennis-ball.692eb061.png";class g extends u{constructor(t){super(t),this.canvas=t,this.name="\u78B0\u649E\u68C0\u6D4B \u2014 \u5206\u79BB\u8F74\u5B9A\u7406",this.shapes=[],this.mousedownPos=new s(0,0),this.mousemovePos=new s(0,0),this.polygonPoints=[[new s(100,100),new s(100,200),new s(200,200)],[new s(300,100),new s(300,200),new s(400,200),new s(400,100)],[new s(500,100),new s(475,200),new s(600,200),new s(625,100)]],this.initShapes().listenEvents()}static init(t){return new g(t)}start(){return this.draw()}draw(){return this.clearScreen().drawGrid().drawScene()}initShapes(){const{polygonPoints:t}=this,h=this.polygonPoints.length;for(let n=0;n<h;++n){const i=new p,l=t[n];i.setPoints(l),i.name=`Polygon ${n}`,i.strokeStyle=this.randomRgba(),i.fillStyle=this.randomRgba(),this.shapes.push(i)}const e=new w("ball",new c(P));return e.left=200,e.top=200,e.width=79,e.height=79,this.shapes.push(new x({name:"golfball",imageSource:y,x:50,y:300})),this.shapes.push(new f({name:"spriteBall",sprite:e,x:e.left,y:e.top})),this}drawShapes(){const{context:t}=this;this.shapes.forEach(h=>{h.stroke(t),h.fill(t)})}drawScene(){return this.drawShapes(),this}detectCollisions(){const{context:t,shapes:h,shapeBeingDragged:e}=this;let n=30;if(!!e)return t.save(),t.font="20px Palatino",h.forEach(i=>{i!==e&&e.collidesWith(i)&&(t.lineWidth=10,t.fillStyle="red",t.strokeStyle="red",t.fillText(`${e.name} Collision with ${i.name}`,20,n),t.strokeRect(0,0,this.width,this.height),n+=40)}),t.restore(),this}listenEvents(){const{canvas:t,context:h,dpr:e,mousedownPos:n,mousemovePos:i,shapes:l}=this;return t.addEventListener("mousedown",r=>{const o=this.coordinateTransformation(r.clientX,r.clientY);l.forEach(a=>{a.isPointInPath(h,o.x*e,o.y*e)&&(this.shapeBeingDragged=a,n.x=o.x,n.y=o.y,i.x=o.x,i.y=o.y)})}),t.addEventListener("mousemove",r=>{var d;const o=this.coordinateTransformation(r.clientX,r.clientY);if(!this.shapeBeingDragged)return;const a={x:o.x-i.x,y:o.y-i.y};(d=this.shapeBeingDragged)==null||d.move(a.x,a.y),i.x=o.x,i.y=o.y,this.draw(),this.detectCollisions()}),t.addEventListener("mouseup",r=>{this.shapeBeingDragged=null}),this}}export{g as Demo};
