var d=Object.defineProperty;var l=(h,t,e)=>t in h?d(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e;var a=(h,t,e)=>(l(h,typeof t!="symbol"?t+"":t,e),e);import{G as c}from"./lil-gui.esm.7a5dd4ff.js";import{B as m}from"./BaseDemo.9c35b300.js";import{A as r}from"./AnimationTimer.e9c92d46.js";import{S as v}from"./Sprite.b43779c9.js";import{b as g}from"./RunnerSprite.bf039336.js";class o extends m{constructor(e){super(e);a(this,"name","\u65F6\u95F4\u52A8\u753B-\u7F13\u52A8\u51FD\u6570\u63A7\u5236\u7CBE\u7075\u8FD0\u52A8");a(this,"ledge");a(this,"runner");a(this,"runBehavior");a(this,"moveBehavior");a(this,"ANIMATION_DURATION",3e3);a(this,"animationTimer",new r(this.ANIMATION_DURATION,r.easeInOut()));a(this,"animationFnMap",{linear:r.linear(),easeIn:r.easeIn(2),easeOut:r.easeOut(2),easeInOut:r.easeInOut(),elastic:r.elastic(4),bounce:r.bounce(4)});a(this,"config",{animationFn:"linear",startRun:()=>this.startAnimation(),endRun:()=>this.endAnimation()});this.canvas=e,this.createControl().initSprite()}static init(e){return new o(e)}createControl(){const{config:e}=this;this.gui=new c;const{gui:i}=this;return i.add(e,"animationFn",Object.keys(this.animationFnMap)).onFinishChange(n=>{this.animationTimer.setTimeWarp(this.animationFnMap[n])}),i.add(e,"startRun"),i.add(e,"endRun"),this}draw(e){return this.clearScreen().drawGrid().drawScene(e)}initSprite(){const{canvas:e,animationTimer:i}=this;return this.runner=new g,this.ledge=new v("ledge",{paint(n,s){s.save(),s.shadowColor="rgba(0,0,0,0.8)",s.fillStyle="rgba(204,204,0,0.6)",s.fillRect(n.x,n.y,n.width,n.height),s.restore()}}),this.ledge.x=0,this.ledge.y=this.height/2,this.ledge.height=5,this.ledge.width=this.width,this.runner.setX(this.ledge.x+this.ledge.width-this.runner.width),this.runner.setY(this.ledge.y-this.runner.height),this.runBehavior=new A(i),this.moveBehavior=new T(i),this.runner.addBehavior(this.runBehavior),this.runner.addBehavior(this.moveBehavior),this.runner.velocityX=100,this}drawScene(e){const{context:i,animationTimer:n}=this;return n.isOver()&&this.endAnimation(),this.ledge.update(i,e),this.ledge.paint(i),this.runner.update(i,e),this.runner.paint(i),this}startAnimation(){const{context:e,animationTimer:i}=this;return i.isRunning()||i.start(),this}endAnimation(){const{context:e,animationTimer:i}=this;return i.stop(),i.reset(),this.runBehavior.reset(),this.moveBehavior.reset(),this}}class A{constructor(t){a(this,"lastAdvance",0);a(this,"PAGEFLIP_INTERVAL",100);this.animationTimer=t}reset(){this.lastAdvance=0}execute(t,e,i){const{animationTimer:n}=this;if(!n.isRunning())return;const s=n.getElapsedTime();this.lastAdvance===0?this.lastAdvance=s:this.lastAdvance!==0&&s-this.lastAdvance>this.PAGEFLIP_INTERVAL&&(t.painter.advance(),this.lastAdvance=s)}}class T{constructor(t){a(this,"lastMove",0);this.animationTimer=t}reset(){this.lastMove=0}execute(t,e,i){const{animationTimer:n}=this;if(!n.isRunning())return;const s=n.getElapsedTime(),u=s-this.lastMove;this.lastMove===0?this.lastMove=s:(t.x-=u/1e3*t.velocityX,t.x=t.x<0?e.canvas.width/window.devicePixelRatio:t.x,this.lastMove=s)}}export{o as Demo};
