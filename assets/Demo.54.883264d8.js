import{G as f}from"./lil-gui.esm.7a5dd4ff.js";import{B as w}from"./BaseDemo.deaf79c0.js";import{r as k}from"./util.064ed5aa.js";import{S as d}from"./Sprite.ec3d1e74.js";const S="/assets/bucket.f8ef9622.png",x=10,p=Math.PI/4;class g extends w{constructor(t){super(t),this.canvas=t,this.name="\u629B\u5C04\u7269\u4F53",this.score=0,this.lastScore=0,this.lastMouse={x:0,y:0},this.launchAngle=p,this.launchVelocity=0,this.pixelsPerMeter=this.width/x,this.ballInFlight=!1,this.threePointer=!1,this.tipsInfo=document.createElement("div"),this.lastBallPosition={x:0,y:0},this.config={ledge:{X:100,Y:this.height-100,WIDTH:100},ball:{RADIUS:10},bucket:{X:this.width-200,Y:this.height-150},drawRay:!1,GRAVITY_FORCE:9.81,launchTime:void 0},this.createControl().addTipsToScene().loadImage(S).then(e=>{this.bucketImage=e,this.initSprite().resetSpriteStatus().listenEvents().startPlay()})}static init(t){return new g(t)}createControl(){const{config:t}=this;this.gui=new f;const{gui:e}=this;return e.add(t.ledge,"X").min(50).max(this.width).step(10).onFinishChange(()=>this.resetSpriteStatus()),e.add(t.ledge,"Y").min(50).max(this.height).step(10).onFinishChange(()=>this.resetSpriteStatus()),e.add(t.ledge,"WIDTH").min(50).max(300).step(10).onFinishChange(()=>this.resetSpriteStatus()),e.add(t.ball,"RADIUS").min(10).max(50).step(5).onFinishChange(()=>this.resetSpriteStatus()),e.add(t.bucket,"X").min(500).max(this.width-100).step(5).onFinishChange(()=>this.resetSpriteStatus()),e.add(t.bucket,"Y").min(10).max(this.height-100).step(5).onFinishChange(()=>this.resetSpriteStatus()),e.add(t,"drawRay").onFinishChange(i=>{t.drawRay=Boolean(i)}),this}start(){return this}draw(t){return this.clearScreen().drawGrid().drawScene(t)}destroy(){super.destroy(),this.tipsInfo.remove()}addTipsToScene(){return k(this.tipsInfo,{position:"absolute",zIndex:"5",cursor:"crosshair",top:"0",left:"50%",transform:"translate(-50%, 0)"}),document.body.appendChild(this.tipsInfo),this}initSprite(){const{config:t,bucketImage:e}=this;this.ledge=new d("ledge",{paint(h,s){s.save(),s.shadowColor="rgba(0,0,0,0.5)",s.shadowBlur=8,s.shadowOffsetX=2,s.shadowOffsetY=2,s.fillStyle="rgba(255,255,0,0.6)",s.strokeStyle="rgba(0,0,0,0.6)",s.beginPath(),s.rect(h.x,h.y,h.width,h.height),s.fill(),s.stroke(),s.restore()}}),this.ball=new d("ball",{paint(h,s){s.save(),s.beginPath(),s.arc(h.x,h.y,t.ball.RADIUS,0,Math.PI*2,!1),s.clip(),s.shadowColor="rgba(0,0,255,0.7)",s.shadowOffsetX=-4,s.shadowOffsetY=-4,s.shadowBlur=8,s.lineWidth=2,s.strokeStyle="rgba(100,100,195,0.8)",s.stroke(),s.beginPath(),s.arc(h.x,h.y,t.ball.RADIUS/2,0,Math.PI*2,!1),s.clip(),s.shadowColor="rgba(255,255,0,1.0)",s.shadowOffsetX=-4,s.shadowOffsetY=-4,s.shadowBlur=8,s.stroke(),s.restore()}},[]),this.bucket=new d("bucket",{paint(h,s){s.strokeStyle="rgba(100,100,195,0.8)",s.rect(h.x,h.y,h.width,h.height),s.stroke(),s.drawImage(e,h.x,h.y)}});const i=new I(this),a=new T(this);return this.ball.addBehavior(i),this.bucket.addBehavior(a),this}drawScene(t){const{context:e,ball:i,ledge:a,bucket:h,config:s}=this;return this.ballInFlight||(this.drawGuidewire(),this.updateBackgroundText(),this.lastScore!==0&&this.resetScoreLater()),a.update(e,t),i.update(e,t),h.update(e,t),a.paint(e),i.paint(e),h.paint(e),this.drawRayGuideline(),this}drawRayGuideline(){const{context:t,config:e,bucket:i}=this;return e.drawRay?(t.save(),t.beginPath(),t.lineWidth=.5,t.strokeStyle="red",t.moveTo(0,i.y+.5),t.lineTo(this.canvas.width,i.y),t.stroke(),t.restore(),this):this}resetScoreLater(){setTimeout(()=>{this.lastScore=0},1e3)}resetSpriteStatus(){const{config:t,bucketImage:e}=this;return this.ledge.x=t.ledge.X,this.ledge.y=t.ledge.Y,this.ledge.width=t.ledge.WIDTH,this.ledge.height=10,this.ball.width=t.ball.RADIUS*2,this.ball.height=t.ball.RADIUS*2,this.ball.x=this.ledge.x+this.ledge.width/2,this.ball.y=this.ledge.y-this.ball.height/2,this.ball.velocityX=0,this.ball.velocityY=0,this.bucket.x=t.bucket.X,this.bucket.y=t.bucket.Y,this.bucket.width=e.width,this.bucket.height=e.height,this.ballInFlight=!1,this}drawGuidewire(){const{context:t,lastMouse:e,ball:i,bucket:a}=this;return t.save(),t.strokeStyle="rgba(200,200,200,0.8)",t.beginPath(),t.setLineDash([4,4]),t.lineDashOffset=5,t.moveTo(i.x,i.y),t.lineTo(e.x,e.y),t.stroke(),t.restore(),this}showText(t){const{context:e,ball:i,bucket:a}=this,h=e.measureText(t);return e.font="42px Helvetica",e.save(),e.shadowColor=void 0,e.strokeStyle="rgb(80,120,210)",e.fillStyle="rgba(100,140,230,0.5)",e.fillText(t,this.width/2-h.width/2,this.height/2),e.strokeText(t,this.width/2-h.width/2,this.height/2),e.restore(),this}updateBackgroundText(){this.lastScore===3?this.showText("\u771F\u5389\u5BB3!"):this.lastScore===2&&this.showText("\u597D\u7403!")}listenEvents(){const{canvas:t,config:e,lastMouse:i,ball:a}=this;return t.addEventListener("mousemove",h=>{if(!this.ballInFlight){const s=this.coordinateTransformation(h.clientX,h.clientY);i.x=s.x,i.y=s.y;const o=i.x-a.x,l=Math.abs(i.y-a.y);this.launchAngle=Math.atan(l/o),this.launchVelocity=4*l/Math.sin(this.launchAngle)/this.pixelsPerMeter||0;const n=this.launchAngle*180/Math.PI,r="Angle: "+n.toFixed(2)+" m/s, Velocity: "+this.launchVelocity.toFixed(2)+" degrees";this.tipsInfo.innerHTML=r}}),t.addEventListener("mousedown",h=>{this.ballInFlight||(a.velocityX=this.launchVelocity*Math.cos(this.launchAngle),a.velocityY=this.launchVelocity*Math.sin(this.launchAngle),this.ballInFlight=!0,this.threePointer=!1,e.launchTime=void 0)}),this}}class I{constructor(t){this.demo=t,this.GRAVITY_FORCE=9.81}applyGravity(t){const{demo:e}=this,{ball:i,config:a}=this.demo;i.velocityY=this.GRAVITY_FORCE*t-e.launchVelocity*Math.sin(e.launchAngle)}updateBallPosition(t){const{demo:e}=this,{ball:i}=this.demo;e.lastBallPosition.x=i.x,e.lastBallPosition.y=i.y,i.x+=i.velocityX*t*e.pixelsPerMeter,i.y+=i.velocityY*t*e.pixelsPerMeter}checkForThreePointer(){const{demo:t}=this,{ball:e}=this.demo;e.y<0&&(t.threePointer=!0,console.log("Three pointer if hit"))}checkBallBounds(){const{demo:t}=this,{ball:e}=this.demo;(e.y>t.height||e.x>t.width)&&t.resetSpriteStatus()}execute(t,e,i){const{demo:a}=this,{ball:h,config:s}=this.demo;let o=0,l=0;a.ballInFlight&&(s.launchTime===void 0&&(s.launchTime=i),o=(i-this.lastFrameTime)/1e3,l=(i-s.launchTime)/1e3,this.applyGravity(l),this.updateBallPosition(o),this.checkForThreePointer(),this.checkBallBounds()),this.lastFrameTime=i}}class T{constructor(t){this.demo=t,this.intersectionPoint={x:0,y:0}}ballInBucket1(){const{ball:t,bucket:e}=this.demo;return t.x>e.x+e.width/2&&t.x<e.x+e.width&&t.y>e.y&&t.y<e.y+e.height}ballInBucket2(){const{ball:t,bucket:e,config:i}=this.demo,a={x:t.x+i.ball.RADIUS,y:t.y+i.ball.RADIUS},h={x:e.x+e.width/2,y:e.y+e.height/2};return Math.sqrt(Math.pow(h.x-a.x,2)+Math.pow(h.y-a.y,2))<i.ball.RADIUS+e.width/8}ballInBucket3(){const{config:t,ball:e,bucket:i,lastBallPosition:a}=this.demo;if(a.x===e.x||a.y===e.y)return!1;const h=a.x,s=a.y;e.x,e.y;const o=i.x+i.width/4,l=i.y,n=i.x+i.width,r=l,c=(e.y-a.y)/(e.x-a.x),u=(r-l)/(n-o),b=s-c*h,m=l-u*o;return this.intersectionPoint.x=(m-b)/(c-u),this.intersectionPoint.y=c*this.intersectionPoint.x+b,this.intersectionPoint.x>o&&this.intersectionPoint.x<n&&e.y+t.ball.RADIUS>l&&e.x+t.ball.RADIUS<n}ballInBucket(){const{config:t,ball:e,bucket:i,lastBallPosition:a}=this.demo,h=e.velocityY/e.velocityX,s=e.y-h*e.x,o=i.y,l=(o-s)/h;return this.intersectionPoint={x:l,y:o},l>i.x&&l<i.x+i.width&&e.x>i.x&&e.x<i.x+i.width&&e.y>i.y&&e.y<i.y+i.height}drawRay(){const{context:t,ball:e}=this.demo;t.beginPath(),t.save(),t.lineWidth=1,t.strokeStyle="blue",t.moveTo(e.x,e.y),t.lineTo(this.intersectionPoint.x,this.intersectionPoint.y),t.stroke(),t.restore()}adjustScore(){const{demo:t}=this;t.threePointer?t.lastScore=3:t.lastScore=2,t.score+=t.lastScore,console.log(this.demo.score)}execute(t,e,i){const{demo:a}=this;a.config.drawRay&&this.drawRay(),a.ballInFlight&&this.ballInBucket()&&(a.resetSpriteStatus(),this.adjustScore())}}export{T as CatchBallBehavior,g as Demo,I as LobBallBehavior};
