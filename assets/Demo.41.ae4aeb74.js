import{G as l}from"./lil-gui.esm.7a5dd4ff.js";import{B as f}from"./BaseDemo.deaf79c0.js";import{S as g,E as u,B as d,N as m}from"./SunglassesFilter.bb50e6c7.js";import{i as w}from"./flower.21c0439b.js";class o extends f{constructor(t){super(t),this.canvas=t,this.name="\u56FE\u50CF\u5904\u7406 \u2014\u2014 \u88C1\u526A\u5E94\u7528\u90E8\u5206\u6EE4\u955C",this.config={scale:.2,filter:0,LENS_RADIUS:this.width/5,resetScene:()=>this.drawScene(),putFilterOn:()=>this.putFilterOn()},this.initOffScreenCanvas(),this.loadImage(w).then(e=>this.image=e).then(()=>{this.drawScene()}),this.createControl()}static init(t){return new o(t)}start(){return this}draw(){return this}initOffScreenCanvas(){const{canvas:t}=this;this.offScreenCanvas=document.createElement("canvas"),this.offScreenContext=this.offScreenCanvas.getContext("2d"),this.offScreenCanvas.width=t.width,this.offScreenCanvas.height=t.height,this.offScreenContext.scale(this.dpr,this.dpr)}createControl(){const{config:t}=this;this.gui=new l;const{gui:e}=this;return e.add(t,"scale").step(.01).min(.1).max(1).onChange(()=>this.drawScene()),e.add(t,"filter",{default:0,negative:1,black_white:2,embossment:3,sunglasses:4}).onFinishChange(s=>this.config.filter=Number(s)),e.add(t,"resetScene"),e.add(t,"putFilterOn"),this}drawScene(){const{canvas:t,context:e,config:s,image:a}=this,h=this.width,i=this.height,n=a.width*s.scale/a.width,r=a.width*s.scale,c=a.height*n;return e.clearRect(0,0,t.width,t.height),e.drawImage(this.image,-r/2+h/2,-c/2+i/2,r,c),this.originalImageData=e.getImageData(0,0,t.width,t.height),this}putFilterOn(){const{canvas:t,context:e,config:s}=this,a={x:this.center.x-s.LENS_RADIUS-10,y:this.center.y},h={x:this.center.x+s.LENS_RADIUS+10,y:this.center.y};let i=null;e.putImageData(this.originalImageData,0,0);const n=e.getImageData(0,0,t.width,t.height);switch(s.filter){case 1:i=new m(n);break;case 2:i=new d(n);break;case 3:i=new u(n);break;case 4:i=new g(n);break;default:i=null}i&&i.dye(),this.offScreenContext.putImageData(n,0,0),this.drawLenses(a,h)}drawLenses(t,e){const{context:s,config:a,offScreenCanvas:h}=this;return s.save(),s.beginPath(),s.arc(t.x,t.y,a.LENS_RADIUS,0,Math.PI*2,!1),s.moveTo(e.x,e.y),s.arc(e.x,e.y,a.LENS_RADIUS,0,Math.PI*2,!1),s.clip(),s.drawImage(h,0,0,this.canvas.width,this.canvas.height),s.restore(),this}}export{o as Demo};
