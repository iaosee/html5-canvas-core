var d=Object.defineProperty;var y=(g,h,t)=>h in g?d(g,h,{enumerable:!0,configurable:!0,writable:!0,value:t}):g[h]=t;var s=(g,h,t)=>(y(g,typeof h!="symbol"?h+"":h,t),t);import{G as R}from"./lil-gui.esm.7a5dd4ff.js";import{B as w,P as u}from"./BaseDemo.9c35b300.js";import{i as x}from"./flower.21c0439b.js";class m extends w{constructor(t){super(t);s(this,"name","\u56FE\u50CF \u2014\u2014 \u653E\u5927\u955C\u5B9E\u73B02");s(this,"image");s(this,"originalImageData");s(this,"magnifyRectangleImageData");s(this,"offScreenCanvas");s(this,"offScreenContext");s(this,"magnifyRectangle",null);s(this,"magnifyingGlassPos",new u);s(this,"config",{scale:.2,zoomScale:2,zoomRadius:150,resetScene:()=>this.drawScene()});this.canvas=t,this.initOffScreenCanvas(),this.loadImage(x).then(e=>this.image=e).then(()=>{this.drawScene()}),this.createControl().listenEvents()}static init(t){return new m(t)}start(){return this}draw(){return this}initOffScreenCanvas(){const{canvas:t}=this;this.offScreenCanvas=document.createElement("canvas"),this.offScreenContext=this.offScreenCanvas.getContext("2d"),this.offScreenCanvas.width=t.width,this.offScreenCanvas.height=t.height}createControl(){const{config:t}=this;this.gui=new R;const{gui:e}=this;return e.add(t,"scale").step(.01).min(.1).max(1).onChange(()=>this.drawScene()),e.add(t,"zoomScale").step(1).min(.5).max(10),e.add(t,"zoomRadius").step(10).min(50).max(1e3),this}drawScene(){const{context:t,offScreenContext:e,canvas:a,config:i,image:n}=this,o=this.width,c=this.height,r=n.width*i.scale/n.width,l=n.width*i.scale,f=n.height*r;return t.clearRect(0,0,a.width,a.height),t.drawImage(this.image,-l/2+o/2,-f/2+c/2,l,f),this.originalImageData=t.getImageData(0,0,a.width,a.height),this}drawMagnifyingGlass(t){const{context:e,config:a,magnifyingGlassPos:i}=this;i.x=t.x,i.y=t.y,this.calculateMagnifyRectangle(t),this.magnifyRectangleImageData=e.getImageData(this.magnifyRectangle.x,this.magnifyRectangle.y,this.magnifyRectangle.width,this.magnifyRectangle.height),this.drawScene(),e.save();const n={width:this.magnifyRectangle.width*a.zoomScale,height:this.magnifyRectangle.height*a.zoomScale};return this.setClip(),e.drawImage(e.canvas,this.magnifyRectangle.x,this.magnifyRectangle.y,this.magnifyRectangle.width,this.magnifyRectangle.height,this.magnifyRectangle.x+this.magnifyRectangle.width/2-n.width/2,this.magnifyRectangle.y+this.magnifyRectangle.height/2-n.height/2,n.width,n.height),e.stroke(),e.restore(),this.drawMagnifyingGlassCircle(t),this}setClip(){const{context:t,config:e,magnifyingGlassPos:a}=this;return t.beginPath(),t.arc(a.x,a.y,e.zoomRadius,0,Math.PI*2,!1),t.clip(),this}calculateMagnifyRectangle(t){const{canvas:e,context:a,config:i}=this;this.magnifyRectangle={x:t.x-i.zoomRadius,y:t.y-i.zoomRadius,width:i.zoomRadius*2+2*a.lineWidth,height:i.zoomRadius*2+2*a.lineWidth};const n=this.magnifyRectangle.y,o=this.magnifyRectangle.x,c=this.magnifyRectangle.y+this.magnifyRectangle.height,r=this.magnifyRectangle.x+this.magnifyRectangle.width;return o<0?(this.magnifyRectangle.width+=o,this.magnifyRectangle.x=0):r>e.width&&(this.magnifyRectangle.width-=r-e.width),n<0?(this.magnifyRectangle.height+=n,this.magnifyRectangle.y=0):c>e.height&&(this.magnifyRectangle.height-=c-e.height),this}drawMagnifyingGlassCircle(t){const{context:e,config:a}=this;let i=a.zoomRadius/7;i=i<10?10:i,i=i>40?40:i,i=10,e.save(),e.lineWidth=i,e.strokeStyle="rgb(0, 0, 255, 0.3)",e.beginPath(),e.arc(t.x,t.y,a.zoomRadius,0,Math.PI*2,!1),e.clip();const n=e.createRadialGradient(t.x,t.y,a.zoomRadius-i,t.x,t.y,a.zoomRadius);return n.addColorStop(0,"rgba(0,0,0,0.2)"),n.addColorStop(.8,"rgb(235,237,255)"),n.addColorStop(.9,"rgb(235,237,255)"),n.addColorStop(1,"rgba(150,150,150,0.9)"),e.shadowColor="rgba(52, 72, 35, 1.0)",e.shadowOffsetX=2,e.shadowOffsetY=2,e.shadowBlur=20,e.strokeStyle=n,e.stroke(),e.beginPath(),e.arc(t.x,t.y,a.zoomRadius-i/2,0,Math.PI*2,!1),e.clip(),e.lineWidth=i,e.strokeStyle="rgba(0,0,0,0.06)",e.stroke(),e.restore(),this}listenEvents(){const{canvas:t}=this;return t.addEventListener("mousemove",e=>{const a=this.coordinateTransformation(e.clientX,e.clientY);this.drawMagnifyingGlass(a)}),this}}export{m as Demo};
