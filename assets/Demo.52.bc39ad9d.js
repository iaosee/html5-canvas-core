var f=Object.defineProperty;var v=(a,s,t)=>s in a?f(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t;var i=(a,s,t)=>(v(a,typeof s!="symbol"?s+"":s,t),t);import{G as S}from"./lil-gui.esm.7a5dd4ff.js";import{B as T}from"./BaseDemo.9c35b300.js";import{A as y}from"./AnimationTimer.e9c92d46.js";import{S as m}from"./Sprite.b43779c9.js";import{I as c}from"./ImagePainter.f7266c8a.js";import{S as u,r as l,R as b,M as w,J as A,a as B}from"./RunnerSprite.bf039336.js";import{b as P}from"./bomb.7e822fe4.js";class x{constructor(s=[],t){i(this,"painters",[]);i(this,"duration",1e3);i(this,"startTime",0);i(this,"index",0);i(this,"elapsedCallback",()=>{});this.painters=s,this.elapsedCallback=t||this.elapsedCallback}end(s,t){s.animating=!1,this.elapsedCallback?this.elapsedCallback(s):s.painter=t}start(s,t){const e=+new Date+t,o=t/this.painters.length,n=s.painter;let r=null;this.index=0,s.animating=!0,s.painter=this.painters[this.index],r=setInterval(()=>{+new Date<e?s.painter=this.painters[++this.index]:(this.end(s,n),clearInterval(r))},o)}}const C="/assets/bomb-no-fuse.09e59735.png";class g extends T{constructor(t){super(t);i(this,"name","\u7CBE\u7075\u7ED8\u5236\u5668 \u2014\u2014 \u7CBE\u7075\u8868\u7ED8\u5236\u5668/\u5E27\u52A8\u753B");i(this,"sprite");i(this,"sprite2");i(this,"sprite3");i(this,"sprite4");i(this,"pushTimer",new y);i(this,"lastAdvance",0);i(this,"bomb");i(this,"bombPainter");i(this,"bombNoFusePainter");i(this,"fuseBurningPainters",[]);i(this,"explosionPainters",[]);i(this,"fuseBurningAnimator");i(this,"explosionAnimator");i(this,"config",{RUN_INTERVAL:100,move4:()=>{this.pushTimer.start()},stop4:()=>{this.pushTimer.stop()},explode:()=>this.bombExplode()});this.canvas=t,this.createControl().initSprite().initBombSprite()}static init(t){return new g(t)}createControl(){const{config:t}=this;this.gui=new S;const{gui:e}=this;return e.add(t,"RUN_INTERVAL").min(10).max(1e3).step(1),e.add(t,"move4"),e.add(t,"stop4"),e.add(t,"explode"),this}draw(t){return this.clearScreen().drawGrid().drawScene(t)}initSprite(){const t=[{x:0,y:0,width:47,height:64},{x:55,y:0,width:44,height:64},{x:107,y:0,width:39,height:64},{x:150,y:0,width:46,height:64},{x:208,y:0,width:49,height:64},{x:265,y:0,width:46,height:64},{x:320,y:0,width:42,height:64},{x:380,y:0,width:35,height:64},{x:425,y:0,width:35,height:64}];return this.sprite=new m("Sprite 1",new u(l,t)),this.sprite2=new m("Sprite 2",new u(l,t),[new b,new w]),this.sprite3=new m("Sprite 3",new u(l,t),[new b,new w,new A]),this.sprite4=new m("Sprite 4",new u(l,t),[new b,new B(this.pushTimer)]),this.sprite.setX(200),this.sprite.setY(200),this.sprite2.setX(400),this.sprite2.setY(200),this.sprite3.setX(600),this.sprite3.setY(200),this.sprite4.setX(800),this.sprite4.setY(200),this.sprite2.velocityX=60,this.sprite3.velocityX=60,this.sprite4.velocityX=60,this}initBombSprite(){this.bombPainter=new c(P),this.bombNoFusePainter=new c(C),this.bomb=new m("bomb",this.bombPainter),this.bomb.setX(500),this.bomb.setY(500),this.fuseBurningAnimator=new x(this.fuseBurningPainters,()=>{this.bomb.painter=this.bombNoFusePainter}),this.explosionAnimator=new x(this.explosionPainters,()=>{this.bomb.painter=this.bombNoFusePainter})}bombExplode(){const{bomb:t,bombPainter:e,fuseBurningAnimator:o,explosionAnimator:n}=this;t.animating||(o.start(t,2e3),setTimeout(()=>{n.start(t,1e3),setTimeout(()=>{t.painter=e},2e3)},3e3))}drawScene(t){const{context:e,config:o,sprite:n,sprite2:r,sprite3:h,sprite4:p,bomb:d}=this;return t-this.lastAdvance>o.RUN_INTERVAL&&(n.painter.advance(),this.lastAdvance=t),n.paint(e),e.fillText(n.name,n.x,n.y),r.update(e,t),r.paint(e),e.fillText(r.name,r.x,r.y),h.update(e,t),h.paint(e),e.fillText(h.name,h.x,h.y),p.update(e,t),p.paint(e),e.fillText(p.name,p.x,p.y),d.update(e,t),d.paint(e),this}}export{g as Demo};
