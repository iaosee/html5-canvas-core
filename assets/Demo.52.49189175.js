import{G as w}from"./lil-gui.esm.7a5dd4ff.js";import{B as x}from"./BaseDemo.deaf79c0.js";import{A as g}from"./AnimationTimer.dddf45c1.js";import{S as h}from"./Sprite.ec3d1e74.js";import{I as u}from"./ImagePainter.41ffde97.js";import{S as o,r as p,R as l,M as b,J as f,a as v}from"./RunnerSprite.d698a488.js";import{b as S}from"./bomb.7e822fe4.js";class d{constructor(t=[],e){this.painters=[],this.duration=1e3,this.startTime=0,this.index=0,this.elapsedCallback=()=>{},this.painters=t,this.elapsedCallback=e||this.elapsedCallback}end(t,e){t.animating=!1,this.elapsedCallback?this.elapsedCallback(t):t.painter=e}start(t,e){const r=+new Date+e,i=e/this.painters.length,n=t.painter;let s=null;this.index=0,t.animating=!0,t.painter=this.painters[this.index],s=setInterval(()=>{+new Date<r?t.painter=this.painters[++this.index]:(this.end(t,n),clearInterval(s))},i)}}const T="/html5-canvas-core/assets/bomb-no-fuse.09e59735.png";class c extends x{constructor(t){super(t),this.canvas=t,this.name="\u7CBE\u7075\u7ED8\u5236\u5668 \u2014\u2014 \u7CBE\u7075\u8868\u7ED8\u5236\u5668/\u5E27\u52A8\u753B",this.pushTimer=new g,this.lastAdvance=0,this.fuseBurningPainters=[],this.explosionPainters=[],this.config={RUN_INTERVAL:100,move4:()=>{this.pushTimer.start()},stop4:()=>{this.pushTimer.stop()},explode:()=>this.bombExplode()},this.createControl().initSprite().initBombSprite()}static init(t){return new c(t)}createControl(){const{config:t}=this;this.gui=new w;const{gui:e}=this;return e.add(t,"RUN_INTERVAL").min(10).max(1e3).step(1),e.add(t,"move4"),e.add(t,"stop4"),e.add(t,"explode"),this}draw(t){return this.clearScreen().drawGrid().drawScene(t)}initSprite(){const t=[{x:0,y:0,width:47,height:64},{x:55,y:0,width:44,height:64},{x:107,y:0,width:39,height:64},{x:150,y:0,width:46,height:64},{x:208,y:0,width:49,height:64},{x:265,y:0,width:46,height:64},{x:320,y:0,width:42,height:64},{x:380,y:0,width:35,height:64},{x:425,y:0,width:35,height:64}];return this.sprite=new h("Sprite 1",new o(p,t)),this.sprite2=new h("Sprite 2",new o(p,t),[new l,new b]),this.sprite3=new h("Sprite 3",new o(p,t),[new l,new b,new f]),this.sprite4=new h("Sprite 4",new o(p,t),[new l,new v(this.pushTimer)]),this.sprite.setX(200),this.sprite.setY(200),this.sprite2.setX(400),this.sprite2.setY(200),this.sprite3.setX(600),this.sprite3.setY(200),this.sprite4.setX(800),this.sprite4.setY(200),this.sprite2.velocityX=60,this.sprite3.velocityX=60,this.sprite4.velocityX=60,this}initBombSprite(){this.bombPainter=new u(S),this.bombNoFusePainter=new u(T),this.bomb=new h("bomb",this.bombPainter),this.bomb.setX(500),this.bomb.setY(500),this.fuseBurningAnimator=new d(this.fuseBurningPainters,()=>{this.bomb.painter=this.bombNoFusePainter}),this.explosionAnimator=new d(this.explosionPainters,()=>{this.bomb.painter=this.bombNoFusePainter})}bombExplode(){const{bomb:t,bombPainter:e,fuseBurningAnimator:r,explosionAnimator:i}=this;t.animating||(r.start(t,2e3),setTimeout(()=>{i.start(t,1e3),setTimeout(()=>{t.painter=e},2e3)},3e3))}drawScene(t){const{context:e,config:r,sprite:i,sprite2:n,sprite3:s,sprite4:a,bomb:m}=this;return t-this.lastAdvance>r.RUN_INTERVAL&&(i.painter.advance(),this.lastAdvance=t),i.paint(e),e.fillText(i.name,i.x,i.y),n.update(e,t),n.paint(e),e.fillText(n.name,n.x,n.y),s.update(e,t),s.paint(e),e.fillText(s.name,s.x,s.y),a.update(e,t),a.paint(e),e.fillText(a.name,a.x,a.y),m.update(e,t),m.paint(e),this}}export{c as Demo};
