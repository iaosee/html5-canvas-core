import{G as w}from"./lil-gui.esm-hsJpI9MV.js";import{B as x}from"./BaseDemo-CScLeyCm.js";import{A as g}from"./AnimationTimer-BfU0TLd1.js";import{S as o}from"./Sprite-DYUj_957.js";import{I as h}from"./ImagePainter-MTFtyqfa.js";import{S as p,r as l,R as m,M as d,J as f,a as S}from"./RunnerSprite-ClBqnfDZ.js";import{b as P}from"./bomb-BLXqLVh_.js";class u{constructor(t=[],e){this.painters=[],this.duration=1e3,this.startTime=0,this.index=0,this.elapsedCallback=()=>{},this.painters=t,this.elapsedCallback=e||this.elapsedCallback}end(t,e){t.animating=!1,this.elapsedCallback?this.elapsedCallback(t):t.painter=e}start(t,e){const i=+new Date+e,s=e/this.painters.length,r=t.painter;let n=null;this.index=0,t.animating=!0,t.painter=this.painters[this.index],n=setInterval(()=>{+new Date<i?t.painter=this.painters[++this.index]:(this.end(t,r),clearInterval(n))},s)}}const T="/html5-canvas-core/assets/bomb-no-fuse-Cu4p7Q0s.png";class c extends x{constructor(t){super(t),this.name="精灵绘制器 —— 精灵表绘制器/帧动画",this.pushTimer=new g,this.lastAdvance=0,this.fuseBurningPainters=[],this.explosionPainters=[],this.config={RUN_INTERVAL:100,move4:()=>{this.pushTimer.start()},stop4:()=>{this.pushTimer.stop()},explode:()=>this.bombExplode()},this.createControl().initSprite().initBombSprite()}static init(t){return new c(t)}createControl(){const{config:t}=this;this.gui=new w;const{gui:e}=this;return e.add(t,"RUN_INTERVAL").min(10).max(1e3).step(1),e.add(t,"move4"),e.add(t,"stop4"),e.add(t,"explode"),this}draw(t){return this.clearScreen().drawGrid().drawScene(t)}initSprite(){const t=[{x:0,y:0,width:47,height:64},{x:55,y:0,width:44,height:64},{x:107,y:0,width:39,height:64},{x:150,y:0,width:46,height:64},{x:208,y:0,width:49,height:64},{x:265,y:0,width:46,height:64},{x:320,y:0,width:42,height:64},{x:380,y:0,width:35,height:64},{x:425,y:0,width:35,height:64}];return this.sprite=new o("Sprite 1",new p(l,t)),this.sprite2=new o("Sprite 2",new p(l,t),[new m,new d]),this.sprite3=new o("Sprite 3",new p(l,t),[new m,new d,new f]),this.sprite4=new o("Sprite 4",new p(l,t),[new m,new S(this.pushTimer)]),this.sprite.setX(200),this.sprite.setY(200),this.sprite2.setX(400),this.sprite2.setY(200),this.sprite3.setX(600),this.sprite3.setY(200),this.sprite4.setX(800),this.sprite4.setY(200),this.sprite2.velocityX=60,this.sprite3.velocityX=60,this.sprite4.velocityX=60,this}initBombSprite(){this.bombPainter=new h(P),this.bombNoFusePainter=new h(T),this.bomb=new o("bomb",this.bombPainter),this.bomb.setX(500),this.bomb.setY(500);for(let i=0;i<9;++i)this.fuseBurningPainters.push(new h("images/bomb/fuse-0"+i+".png"));for(let i=0;i<9;++i)this.explosionPainters.push(new h("images/bomb/explosion-0"+i+".png"));this.fuseBurningAnimator=new u(this.fuseBurningPainters,()=>{this.bomb.painter=this.bombNoFusePainter}),this.explosionAnimator=new u(this.explosionPainters,()=>{this.bomb.painter=this.bombNoFusePainter})}bombExplode(){const{bomb:t,bombPainter:e,fuseBurningAnimator:i,explosionAnimator:s}=this;t.animating||(i.start(t,2e3),setTimeout(()=>{s.start(t,1e3),setTimeout(()=>{t.painter=e},2e3)},3e3))}drawScene(t){const{context:e,config:i,sprite:s,sprite2:r,sprite3:n,sprite4:a,bomb:b}=this;return t-this.lastAdvance>i.RUN_INTERVAL&&(s.painter.advance(),this.lastAdvance=t),s.paint(e),e.fillText(s.name,s.x,s.y),r.update(e,t),r.paint(e),e.fillText(r.name,r.x,r.y),n.update(e,t),n.paint(e),e.fillText(n.name,n.x,n.y),a.update(e,t),a.paint(e),e.fillText(a.name,a.x,a.y),b.update(e,t),b.paint(e),this}}export{c as Demo};
