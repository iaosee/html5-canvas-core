import{B as f,P as c}from"./BaseDemo-CScLeyCm.js";class h extends f{constructor(i){super(i),this.name="拖拽交互 —— 扔球/惯性运动",this.lastTime=0,this.ball={position:this.center,velocityX:5,velocityY:5,radius:100,color:this.randomRgba()},this.listenEvents(),this.drawGrid().drawCircle()}static init(i){return new h(i)}start(){return this}draw(){return this.clearScreen().drawGrid().drawCircle()}drawCircle(){const{context:i,ball:o}=this;return i.lineWidth=1.5,i.fillStyle=o.color,i.strokeStyle=o.color,i.beginPath(),i.arc(o.position.x,o.position.y,o.radius,0,Math.PI*2,!1),i.fill(),i.stroke(),this}setCirclePosition(i){const{context:o,ball:t}=this;return t.position=i,t.position.x+t.radius>this.width&&(t.position.x=this.width-t.radius),t.position.x-t.radius<0&&(t.position.x=t.radius),t.position.y+t.radius>this.height&&(t.position.y=this.height-t.radius),t.position.y-t.radius<0&&(t.position.y=t.radius),this}updatePosition(){const{ball:i}=this;return(i.position.x+i.velocityX+i.radius>this.width||i.position.x+i.velocityX-i.radius<0)&&(i.velocityX=-i.velocityX*.8),(i.position.y+i.velocityY+i.radius>this.height||i.position.y+i.velocityY-i.radius<0)&&(i.velocityY=-i.velocityY*.8),i.position.x+=i.velocityX,i.position.y+=i.velocityY,this}isPointInCirclePath(i){const{context:o,dpr:t,ball:s}=this;return o.beginPath(),o.arc(s.position.x,s.position.y,s.radius,0,Math.PI*2,!1),o.closePath(),o.isPointInPath(i.x*t,i.y*t)}animate(){this.updatePosition().draw(),this.player=requestAnimationFrame(this.animate.bind(this))}listenEvents(){const{canvas:i,ball:o}=this;let t=!1,s=null,n=null,a=null,l=0,d=0;const u=()=>{const e=d-l;return(Math.abs(n.x-s.x)+Math.abs(n.y-s.y))/e*10>10},p=e=>{s=this.coordinateTransformation(e.clientX,e.clientY),l=Date.now(),this.isPointInCirclePath(s)&&(this.stop(),t=!0,a=new c(s.x-o.position.x,s.y-o.position.y))},y=e=>{if(!t)return;const r=this.coordinateTransformation(e.clientX,e.clientY);this.setCirclePosition(new c(r.x-a.x,r.y-a.y)),this.draw()},m=e=>{d=Date.now(),n=this.coordinateTransformation(e.clientX,e.clientY),t&&u()&&(console.log("didThrow"),o.velocityX=(n.x-s.x)/20,o.velocityY=(n.y-s.y)/20,this.player=requestAnimationFrame(this.animate.bind(this))),t=!1};return i.addEventListener("mousedown",p,!1),i.addEventListener("mousemove",y,!1),document.addEventListener("mouseup",m,!1),document.addEventListener("contextmenu",e=>e.preventDefault(),!1),this}}export{h as Demo};
