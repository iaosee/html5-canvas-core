import{G as u}from"./lil-gui.esm.7a5dd4ff.js";import{B as f}from"./BaseDemo.deaf79c0.js";import{A as n}from"./AnimationTimer.dddf45c1.js";import{S as o}from"./Sprite.ec3d1e74.js";class r extends f{constructor(i){super(i),this.canvas=i,this.name="\u7269\u7406\u6548\u679C \u2014\u2014 \u7269\u4F53\u4E0B\u843D",this.pushAnimationTimer=new n,this.fallingAnimationTimer=new n,this.config={BALL_RADIUS:30,LEDGE_WIDTH:200,GRAVITY_FORCE:9.81,moveToLeft:()=>this.pushBallLeft(),moveToRight:()=>this.pushBallRight()},this.createControl().initSprite().listenEvents()}static init(i){return new r(i)}createControl(){const{config:i}=this;this.gui=new u;const{gui:t}=this;return t.add(i,"BALL_RADIUS").min(10).max(100).step(10).onFinishChange(()=>this.initSprite()),t.add(i,"LEDGE_WIDTH").min(100).max(600).step(10).onFinishChange(()=>this.initSprite()),t.add(i,"moveToLeft"),t.add(i,"moveToRight"),this}draw(i){return this.clearScreen().drawGrid().drawScene(i)}initSprite(){const{config:i}=this;this.ledge=new o("ledge",{paint(l,s){s.save(),s.shadowColor="rgba(0,0,0,0.5)",s.shadowBlur=8,s.shadowOffsetX=2,s.shadowOffsetY=2,s.fillStyle="rgba(255,255,0,0.6)",s.strokeStyle="rgba(0,0,0,0.6)",s.beginPath(),s.rect(l.x,l.y,l.width,l.height),s.fill(),s.stroke(),s.restore()}}),this.ball=new o("ball",{paint(l,s){s.save(),s.beginPath(),s.arc(l.x+l.width/2,l.y+l.height/2,i.BALL_RADIUS,0,Math.PI*2,!1),s.clip(),s.shadowColor="rgba(0,0,255,0.7)",s.shadowOffsetX=-4,s.shadowOffsetY=-4,s.shadowBlur=8,s.lineWidth=2,s.strokeStyle="rgba(100,100,195,0.8)",s.stroke(),s.beginPath(),s.arc(l.x+l.width/2,l.y+l.height/2,i.BALL_RADIUS/2,0,Math.PI*2,!1),s.clip(),s.shadowColor="rgba(255,255,0,1.0)",s.shadowOffsetX=-4,s.shadowOffsetY=-4,s.shadowBlur=8,s.stroke(),s.restore()}},[]);const t=new w(this.pushAnimationTimer,this.fallingAnimationTimer,this.ball,this.ledge);return this.ball.addBehavior(t),this.ball.width=i.BALL_RADIUS*2,this.ball.height=i.BALL_RADIUS*2,this.ball.x=this.center.x-this.ball.width/2,this.ball.y=50,this.ball.velocityX=100,this.ball.velocityY=0,this.ledge.width=i.LEDGE_WIDTH,this.ledge.x=this.center.x-this.ledge.width/2,this.ledge.y=this.ball.y+this.ball.height,this}pushBall(){const{pushAnimationTimer:i}=this;i.isRunning()&&i.stop(),i.start()}pushBallLeft(){const{ball:i}=this;i.velocityX=i.velocityX<0?i.velocityX:-i.velocityX,this.pushBall()}pushBallRight(){const{ball:i}=this;i.velocityX=i.velocityX>0?i.velocityX:-i.velocityX,this.pushBall()}drawScene(i){const{context:t,ball:l,ledge:s}=this;return s.update(t,i),l.update(t,i),s.paint(t),l.paint(t),this}listenEvents(){return addEventListener("keydown",i=>{i.keyCode===37?this.pushBallLeft():i.keyCode===39&&this.pushBallRight()}),this}}class w{constructor(i,t,l,s){this.pushAnimationTimer=i,this.fallingAnimationTimer=t,this.ball=l,this.ledge=s}isBallOnLedge(){const{ball:i,ledge:t}=this;return i.x+i.width/2>t.x&&i.x+i.width/2<t.x+t.width}startFalling(){this.fallingAnimationTimer.start(),this.ball.velocityY=0}stopFalling(){this.fallingAnimationTimer.stop(),this.pushAnimationTimer.stop(),this.ball.x=this.ledge.x+this.ledge.width/2-this.ball.width/2,this.ball.y=this.ledge.y-this.ball.width/2*2,this.ball.velocityY=0}execute(i,t,l){const{pushAnimationTimer:s,fallingAnimationTimer:e}=this,h=+new Date,a=1e3/(h-this.lastFrameTime),d=9.81,g=10,m=(t.canvas.height-this.ledge.y)/g;s.isRunning()&&(i.x+=i.velocityX/a,this.isBallOnLedge()?s.getElapsedTime()>200&&s.stop():e.isRunning()||(this.startFalling(),this.lastFrameTime=h)),e.isRunning()&&(i.y+=i.velocityY/a,i.velocityY=d*(e.getElapsedTime()/1e3)*m,i.y>t.canvas.height&&this.stopFalling()),this.lastFrameTime=h}}export{r as Demo,w as MoveBallBehavior};
