import{B as r}from"./BaseDemo-CScLeyCm.js";class s extends r{constructor(t){super(t),this.name="拖拽绘制矩形",this.dragging=!1,this.rectangles=[],this.mousedownPosition={x:0,y:0},this.draggingRect={x:0,y:0,width:0,height:0,color:this.randomRgba()},this.listenEvents()}static init(t){return new s(t)}start(){return this.draw().drawRectangles()}draw(){return this.clearScreen().drawGrid()}drawRectangles(){for(let t=0,e=this.rectangles.length;t<e;t++)this.drawRectangleFill(this.rectangles[t]);return this}drawRectangleLine(t){const{context:e}=this;return e.strokeStyle=t.color,e.strokeRect(t.x,t.y,t.width,t.height),e.stroke(),this}drawRectangleFill(t){const{context:e}=this;return e.fillStyle=t.color,e.fillRect(t.x,t.y,t.width,t.height),e.fill(),this}listenEvents(){const{context:t,canvas:e}=this;e.addEventListener("mousedown",this.mousedownHandler(),!1),document.addEventListener("mousemove",this.mousemoveHandler(),!1),document.addEventListener("mouseup",this.mouseupHandler(),!1),window.addEventListener("keyup",this.keyupHandler(),!1)}draggingStart(t,e){return this.dragging=!0,this.draggingRect.x=this.mousedownPosition.x=t,this.draggingRect.y=this.mousedownPosition.y=e,this.draggingRect.color=this.randomRgba(),this}draggingMove(t,e){return this.draggingRect.x=t<this.mousedownPosition.x?t:this.mousedownPosition.x,this.draggingRect.y=e<this.mousedownPosition.y?e:this.mousedownPosition.y,this.draggingRect.width=Math.abs(t-this.mousedownPosition.x),this.draggingRect.height=Math.abs(e-this.mousedownPosition.y),this}draggingEnd(){return this.dragging=!1,this.drawRectangleFill(this.draggingRect),this.rectangles.push(Object.assign({},this.draggingRect)),this}mousedownHandler(){return t=>{const e=t.x||t.clientX,n=t.y||t.clientY,i=this.coordinateTransformation(e,n);t.preventDefault(),this.draggingStart(i.x,i.y)}}mousemoveHandler(){return t=>{const e=t.x||t.clientX,n=t.y||t.clientY,i=this.coordinateTransformation(e,n);t.preventDefault(),this.dragging&&(this.draggingMove(i.x,i.y),this.clearScreen().drawGrid().drawRectangles().drawRectangleFill(this.draggingRect).drawGuidelines(i.x,i.y))}}mouseupHandler(){return t=>{t.preventDefault(),this.clearScreen().drawGrid().draggingEnd().drawRectangles()}}keyupHandler(){return t=>{t.preventDefault(),this.rectangles.splice(0,this.rectangles.length),this.clearScreen().drawGrid().drawRectangles()}}}export{s as Demo};
