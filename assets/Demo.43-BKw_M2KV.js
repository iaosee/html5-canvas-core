import{G as d}from"./lil-gui.esm-hsJpI9MV.js";import{B as g,P as l}from"./BaseDemo-CScLeyCm.js";import{i as f}from"./flower-BOKp_aAz.js";class h extends g{constructor(i){super(i),this.name="图像 —— 放大镜实现",this.magnifyRectangle=null,this.magnifyingGlassPos=new l,this.config={scale:.2,zoomScale:2,zoomRadius:150,resetScene:()=>this.drawScene()},this.initOffScreenCanvas(),this.loadImage(f).then(e=>this.image=e).then(()=>{this.drawScene()}),this.createControl().listenEvents()}static init(i){return new h(i)}start(){return this}draw(){return this}initOffScreenCanvas(){this.offScreenCanvas=document.createElement("canvas"),this.offScreenContext=this.offScreenCanvas.getContext("2d"),this.offScreenCanvas.width=this.width,this.offScreenCanvas.height=this.height}createControl(){const{config:i}=this;this.gui=new d;const{gui:e}=this;return e.add(i,"scale").step(.01).min(.1).max(1).onChange(()=>this.drawScene()),e.add(i,"zoomScale").step(1).min(.5).max(10),e.add(i,"zoomRadius").step(10).min(50).max(1e3),this}drawScene(){const{context:i,offScreenContext:e,canvas:t,config:s,image:a}=this,c=this.width,r=this.height,m=a.width*s.scale/a.width,n=a.width*s.scale,o=a.height*m;return i.clearRect(0,0,t.width,t.height),i.drawImage(this.image,-n/2+c/2,-o/2+r/2,n,o),this.originalImageData=i.getImageData(0,0,t.width,t.height),this}drawMagnifyingGlass(i){const{context:e,config:t}=this;return this.magnifyingGlassPos.x=i.x,this.magnifyingGlassPos.x=i.y,e.clearRect(0,0,e.canvas.width,e.canvas.height),this.drawScene(),e.save(),e.lineWidth=t.zoomRadius*.1,e.strokeStyle="rgba(100,255,255,0.5)",e.beginPath(),e.arc(i.x,i.y,t.zoomRadius,0,Math.PI*2,!1),e.clip(),e.drawImage(e.canvas,i.x-t.zoomRadius,i.y-t.zoomRadius,t.zoomRadius*2,t.zoomRadius*2,i.x-t.zoomRadius-(t.zoomRadius*2*t.zoomScale-t.zoomRadius*2)/2,i.y-t.zoomRadius-(t.zoomRadius*2*t.zoomScale-t.zoomRadius*2)/2,t.zoomRadius*2*t.zoomScale,t.zoomRadius*2*t.zoomScale),e.stroke(),e.restore(),this}listenEvents(){const{canvas:i}=this;return i.addEventListener("mousemove",e=>{const t=this.coordinateTransformation(e.clientX,e.clientY);this.drawMagnifyingGlass(t)}),this}}export{h as Demo};
